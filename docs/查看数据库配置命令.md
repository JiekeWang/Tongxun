# æŸ¥çœ‹æœåŠ¡å™¨æ•°æ®åº“é…ç½®å‘½ä»¤

## æ–¹æ³•1ï¼šæŸ¥çœ‹ .env æ–‡ä»¶ï¼ˆæ¨èï¼‰

### æŸ¥çœ‹å®Œæ•´çš„ .env æ–‡ä»¶
```bash
cat /var/www/tongxun/server/.env
```

### åªæŸ¥çœ‹æ•°æ®åº“ç›¸å…³é…ç½®
```bash
grep -E "DB_|DATABASE" /var/www/tongxun/server/.env
```

### æŸ¥çœ‹ç‰¹å®šé…ç½®é¡¹
```bash
# æŸ¥çœ‹æ•°æ®åº“ä¸»æœº
grep DB_HOST /var/www/tongxun/server/.env

# æŸ¥çœ‹æ•°æ®åº“ç”¨æˆ·å
grep DB_USER /var/www/tongxun/server/.env

# æŸ¥çœ‹æ•°æ®åº“åç§°
grep DB_NAME /var/www/tongxun/server/.env

# æŸ¥çœ‹æ•°æ®åº“ç«¯å£
grep DB_PORT /var/www/tongxun/server/.env
```

## æ–¹æ³•2ï¼šæŸ¥çœ‹é…ç½®æ–‡ä»¶

### æŸ¥çœ‹ database.js é…ç½®
```bash
cat /var/www/tongxun/server/src/config/database.js | grep -A 10 "host\|user\|password\|database"
```

## æ–¹æ³•3ï¼šæŸ¥çœ‹ç¯å¢ƒå˜é‡

### æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
```bash
env | grep DB
```

### æŸ¥çœ‹ Node.js è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœæœåŠ¡æ­£åœ¨è¿è¡Œï¼‰
```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 env <app_name> | grep DB

# æˆ–è€…æŸ¥çœ‹è¿›ç¨‹çš„ç¯å¢ƒå˜é‡
ps eww -p $(pgrep -f "node.*server") | grep DB
```

## æ–¹æ³•4ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

### ä½¿ç”¨ MySQL å®¢æˆ·ç«¯æµ‹è¯•è¿æ¥
```bash
# å…ˆæŸ¥çœ‹é…ç½®
DB_HOST=$(grep DB_HOST /var/www/tongxun/server/.env | cut -d '=' -f2)
DB_USER=$(grep DB_USER /var/www/tongxun/server/.env | cut -d '=' -f2)
DB_PASSWORD=$(grep DB_PASSWORD /var/www/tongxun/server/.env | cut -d '=' -f2)
DB_NAME=$(grep DB_NAME /var/www/tongxun/server/.env | cut -d '=' -f2)

# æµ‹è¯•è¿æ¥
mysql -h $DB_HOST -u $DB_USER -p$DB_PASSWORD -e "SELECT 1" $DB_NAME
```

### æˆ–è€…ç›´æ¥ä½¿ç”¨é…ç½®çš„å€¼
```bash
mysql -h localhost -u wangjia -pqazQAZ123 -e "SELECT 1" tongxun
```

## å¿«é€ŸæŸ¥çœ‹å‘½ä»¤ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

### æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“é…ç½®
```bash
echo "=== æ•°æ®åº“é…ç½® ===" && \
grep -E "^DB_" /var/www/tongxun/server/.env | sed 's/PASSWORD=.*/PASSWORD=***/' && \
echo "" && \
echo "=== æ•°æ®åº“è¿æ¥æµ‹è¯• ===" && \
mysql -h $(grep DB_HOST /var/www/tongxun/server/.env | cut -d '=' -f2) \
      -u $(grep DB_USER /var/www/tongxun/server/.env | cut -d '=' -f2) \
      -p$(grep DB_PASSWORD /var/www/tongxun/server/.env | cut -d '=' -f2) \
      -e "SELECT 'è¿æ¥æˆåŠŸ' AS status, DATABASE() AS current_database;" \
      $(grep DB_NAME /var/www/tongxun/server/.env | cut -d '=' -f2) 2>/dev/null || echo "è¿æ¥å¤±è´¥"
```

## æŸ¥çœ‹é…ç½®çš„å®Œæ•´è„šæœ¬

åˆ›å»º `check-db-config.sh`ï¼š

```bash
#!/bin/bash

ENV_FILE="/var/www/tongxun/server/.env"

echo "=========================================="
echo "æ•°æ®åº“é…ç½®ä¿¡æ¯"
echo "=========================================="

if [ -f "$ENV_FILE" ]; then
    echo ""
    echo "ğŸ“„ é…ç½®æ–‡ä»¶: $ENV_FILE"
    echo ""
    echo "æ•°æ®åº“é…ç½®ï¼š"
    echo "----------------------------------------"
    grep -E "^DB_" "$ENV_FILE" | while IFS='=' read -r key value; do
        if [[ "$key" == *"PASSWORD"* ]]; then
            echo "$key=***"
        else
            echo "$key=$value"
        fi
    done
    
    echo ""
    echo "=========================================="
    echo "æµ‹è¯•æ•°æ®åº“è¿æ¥"
    echo "=========================================="
    
    DB_HOST=$(grep "^DB_HOST=" "$ENV_FILE" | cut -d '=' -f2)
    DB_USER=$(grep "^DB_USER=" "$ENV_FILE" | cut -d '=' -f2)
    DB_PASSWORD=$(grep "^DB_PASSWORD=" "$ENV_FILE" | cut -d '=' -f2)
    DB_NAME=$(grep "^DB_NAME=" "$ENV_FILE" | cut -d '=' -f2)
    DB_PORT=$(grep "^DB_PORT=" "$ENV_FILE" | cut -d '=' -f2 || echo "3306")
    
    if mysql -h "$DB_HOST" -P "$DB_PORT" -u "$DB_USER" -p"$DB_PASSWORD" -e "SELECT 1" "$DB_NAME" 2>/dev/null; then
        echo "âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ"
        echo ""
        echo "å½“å‰æ•°æ®åº“: $DB_NAME"
        echo "æ•°æ®åº“ä¸»æœº: $DB_HOST:$DB_PORT"
        echo "æ•°æ®åº“ç”¨æˆ·: $DB_USER"
    else
        echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥"
        echo "è¯·æ£€æŸ¥é…ç½®å’Œæ•°æ®åº“æœåŠ¡çŠ¶æ€"
    fi
else
    echo "âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $ENV_FILE"
fi
```

## å¸¸ç”¨å‘½ä»¤æ€»ç»“

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `cat .env` | æŸ¥çœ‹å®Œæ•´çš„ .env æ–‡ä»¶ |
| `grep DB_ .env` | æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“é…ç½® |
| `grep DB_HOST .env` | æŸ¥çœ‹æ•°æ®åº“ä¸»æœº |
| `grep DB_USER .env` | æŸ¥çœ‹æ•°æ®åº“ç”¨æˆ·å |
| `grep DB_NAME .env` | æŸ¥çœ‹æ•°æ®åº“åç§° |
| `mysql -h host -u user -p` | æµ‹è¯•æ•°æ®åº“è¿æ¥ |

## æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**ï¼šæŸ¥çœ‹é…ç½®æ—¶ï¼Œå¯†ç å¯èƒ½ä¼šæ˜¾ç¤ºåœ¨ç»ˆç«¯ï¼Œæ³¨æ„ä¿æŠ¤éšç§
2. **æ–‡ä»¶è·¯å¾„**ï¼šç¡®ä¿è·¯å¾„æ­£ç¡®ï¼š`/var/www/tongxun/server/.env`
3. **æƒé™**ï¼šå¯èƒ½éœ€è¦ root æƒé™æ‰èƒ½æŸ¥çœ‹æŸäº›æ–‡ä»¶

## é¢„æœŸè¾“å‡ºç¤ºä¾‹

```
DB_HOST=localhost
DB_PORT=3306
DB_USER=wangjia
DB_PASSWORD=qazQAZ123
DB_NAME=tongxun
```


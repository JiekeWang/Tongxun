# 域名解析问题修复

## 🔍 问题分析

- ✅ IP访问正常：`http://47.116.197.230:3000/api/health`
- ❌ 域名访问失败：`http://zhihome.com.cn:3000/api/health`

**结论：** 域名DNS解析未正确配置或未生效。

---

## 🚀 修复步骤

### 1. 检查域名解析（本地）

在 Windows PowerShell 中执行：

```powershell
# 检查域名解析
nslookup zhihome.com.cn

# 或使用 ping
ping zhihome.com.cn
```

**应该返回：** `47.116.197.230`

**如果返回其他IP或无法解析：** 需要配置DNS记录。

---

### 2. 配置域名DNS记录

#### 方法1：在域名管理后台配置

1. **登录域名管理后台**
   - 找到你的域名注册商（如阿里云、腾讯云、GoDaddy等）
   - 登录域名管理控制台

2. **添加A记录**
   - 进入 **DNS解析** 或 **域名解析** 页面
   - 找到域名 `zhihome.com.cn`
   - 点击 **添加记录** 或 **解析设置**

3. **配置A记录**
   ```
   记录类型：A
   主机记录：@（或留空，表示根域名）
   记录值：47.116.197.230
   TTL：600（或默认值）
   ```

4. **可选：添加www子域名**
   ```
   记录类型：A
   主机记录：www
   记录值：47.116.197.230
   TTL：600
   ```

5. **保存并等待生效**
   - DNS记录通常需要几分钟到几小时生效
   - 可以等待10-30分钟后再次测试

---

### 3. 验证DNS解析

#### 方法1：使用nslookup（Windows）

```powershell
nslookup zhihome.com.cn
```

**应该看到：**
```
名称:    zhihome.com.cn
Address:  47.116.197.230
```

#### 方法2：使用ping

```powershell
ping zhihome.com.cn
```

**应该看到：**
```
正在 Ping zhihome.com.cn [47.116.197.230] ...
```

#### 方法3：在线DNS查询工具

访问以下网站查询：
- https://tool.chinaz.com/dns/
- https://www.whatsmydns.net/
- https://dnschecker.org/

输入域名 `zhihome.com.cn`，查看A记录是否指向 `47.116.197.230`

---

### 4. 清除DNS缓存（如果解析已更新但仍无法访问）

#### Windows PowerShell（管理员权限）

```powershell
# 清除DNS缓存
ipconfig /flushdns

# 然后重新测试
nslookup zhihome.com.cn
```

#### 或在浏览器中测试

- 清除浏览器缓存
- 使用无痕模式访问：`http://zhihome.com.cn:3000/api/health`

---

## 🔧 如果域名解析正确但仍无法访问

### 检查域名是否被防火墙拦截

在服务器上检查：

```bash
# 检查防火墙规则
firewall-cmd --list-all

# 确保3000端口已开放
firewall-cmd --list-ports
```

### 检查Nginx配置（如果使用了Nginx反向代理）

如果配置了Nginx，需要确保：

```nginx
server {
    listen 80;
    server_name zhihome.com.cn;

    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 📝 快速诊断命令

### 在本地PowerShell：

```powershell
# 1. 检查域名解析
nslookup zhihome.com.cn

# 2. 清除DNS缓存
ipconfig /flushdns

# 3. 再次检查
nslookup zhihome.com.cn

# 4. 测试IP访问
curl http://47.116.197.230:3000/api/health

# 5. 测试域名访问
curl http://zhihome.com.cn:3000/api/health
```

---

## ✅ 验证清单

- [ ] 域名DNS记录已配置（A记录指向 47.116.197.230）
- [ ] DNS记录已生效（nslookup 返回正确IP）
- [ ] 本地DNS缓存已清除
- [ ] IP访问正常
- [ ] 域名访问正常

---

## 🆘 常见问题

### Q1: DNS记录已配置，但仍无法解析

**A:** 
1. 等待DNS传播（通常10分钟-2小时）
2. 清除本地DNS缓存：`ipconfig /flushdns`
3. 使用公共DNS（如8.8.8.8）测试：`nslookup zhihome.com.cn 8.8.8.8`

### Q2: 域名解析正确，但浏览器仍无法访问

**A:**
1. 清除浏览器缓存
2. 使用无痕模式
3. 检查浏览器控制台错误信息
4. 尝试其他浏览器

### Q3: 不知道域名注册商

**A:**
1. 使用WHOIS查询：https://whois.chinaz.com/
2. 输入域名查看注册信息
3. 根据注册商登录对应的管理后台

---

## 📌 重要提示

1. **DNS传播时间**：DNS记录修改后，全球生效可能需要几分钟到48小时
2. **TTL值**：设置较小的TTL（如600秒）可以加快DNS更新速度
3. **多地区测试**：使用在线DNS查询工具检查全球DNS解析是否一致


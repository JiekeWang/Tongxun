# æ—¥å¿—æŸ¥çœ‹å‘½ä»¤

## ğŸ“‹ PM2 æ—¥å¿—å‘½ä»¤

### 1. æŸ¥çœ‹å®æ—¶æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å®æ—¶æ—¥å¿—
pm2 logs

# æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„å®æ—¶æ—¥å¿—
pm2 logs tongxun-server

# æŸ¥çœ‹æœ€è¿‘Nè¡Œæ—¥å¿—
pm2 logs tongxun-server --lines 50
```

### 2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/www/tongxun/server/logs/pm2-error.log

# æŸ¥çœ‹è¾“å‡ºæ—¥å¿—
tail -f /var/www/tongxun/server/logs/pm2-out.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œé”™è¯¯æ—¥å¿—
tail -n 100 /var/www/tongxun/server/logs/pm2-error.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œè¾“å‡ºæ—¥å¿—
tail -n 100 /var/www/tongxun/server/logs/pm2-out.log
```

### 3. æŸ¥çœ‹ç‰¹å®šç±»å‹çš„æ—¥å¿—

```bash
# åªæŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs tongxun-server --err

# åªæŸ¥çœ‹è¾“å‡ºæ—¥å¿—
pm2 logs tongxun-server --out

# æŸ¥çœ‹æœ€è¿‘50è¡Œï¼Œåªæ˜¾ç¤ºé”™è¯¯
pm2 logs tongxun-server --err --lines 50
```

### 4. æ¸…ç©ºæ—¥å¿—

```bash
# æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
pm2 flush

# æ¸…ç©ºæŒ‡å®šæœåŠ¡çš„æ—¥å¿—
pm2 flush tongxun-server
```

---

## ğŸ” åº”ç”¨æ—¥å¿—ï¼ˆWinstonï¼‰

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶

```bash
cd /var/www/tongxun/server

# æŸ¥çœ‹æ—¥å¿—ç›®å½•
ls -la logs/

# æŸ¥çœ‹æœ€æ–°çš„åº”ç”¨æ—¥å¿—
tail -f logs/app-*.log

# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
cat logs/app-$(date +%Y-%m-%d).log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -n 100 logs/app-*.log

# æœç´¢ç‰¹å®šå†…å®¹
grep "é”™è¯¯" logs/app-*.log
grep "æ•°æ®åº“è¿æ¥" logs/app-*.log
```

---

## ğŸ“Š ç³»ç»Ÿæ—¥å¿—

### 1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆæœ€è¿‘100è¡Œï¼‰
journalctl -n 100

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå®æ—¶ï¼‰
journalctl -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
journalctl -u mysql
journalctl -u redis
```

### 2. æŸ¥çœ‹Nginxæ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

---

## ğŸ”§ å¸¸ç”¨ç»„åˆå‘½ä»¤

### 1. æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
pm2 show tongxun-server

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
pm2 logs tongxun-server --lines 30
```

### 2. ç›‘æ§æœåŠ¡

```bash
# å®æ—¶ç›‘æ§ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰
pm2 monit

# æŸ¥çœ‹æœåŠ¡ä¿¡æ¯
pm2 info tongxun-server
```

### 3. æœç´¢æ—¥å¿—å†…å®¹

```bash
# åœ¨PM2æ—¥å¿—ä¸­æœç´¢
pm2 logs tongxun-server | grep "é”™è¯¯"
pm2 logs tongxun-server | grep "æ•°æ®åº“"

# åœ¨æ—¥å¿—æ–‡ä»¶ä¸­æœç´¢
grep -r "é”™è¯¯" /var/www/tongxun/server/logs/
grep -r "æ•°æ®åº“è¿æ¥" /var/www/tongxun/server/logs/
```

---

## ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

### PM2æ—¥å¿—
- é”™è¯¯æ—¥å¿—ï¼š`/var/www/tongxun/server/logs/pm2-error.log`
- è¾“å‡ºæ—¥å¿—ï¼š`/var/www/tongxun/server/logs/pm2-out.log`

### åº”ç”¨æ—¥å¿—ï¼ˆWinstonï¼‰
- æ—¥å¿—ç›®å½•ï¼š`/var/www/tongxun/server/logs/`
- æ—¥å¿—æ–‡ä»¶ï¼š`app-YYYY-MM-DD.log`

---

## ğŸš€ å¿«é€ŸæŸ¥çœ‹å‘½ä»¤

### æœ€å¸¸ç”¨çš„å‘½ä»¤

```bash
# 1. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆæœ€å¸¸ç”¨ï¼‰
pm2 logs tongxun-server

# 2. æŸ¥çœ‹æœ€è¿‘50è¡Œ
pm2 logs tongxun-server --lines 50

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# 4. æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
pm2 show tongxun-server
```

### é€€å‡ºæ—¥å¿—æŸ¥çœ‹

- æŒ‰ `Ctrl+C` é€€å‡ºå®æ—¶æ—¥å¿—æŸ¥çœ‹

---

## ğŸ” æ—¥å¿—åˆ†ææŠ€å·§

### 1. æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
pm2 logs tongxun-server --lines 1000 | grep "$(date +%Y-%m-%d)"

# æŸ¥çœ‹æœ€è¿‘1å°æ—¶çš„æ—¥å¿—
pm2 logs tongxun-server --lines 500 | grep "$(date +%H)"
```

### 2. ç»Ÿè®¡é”™è¯¯æ•°é‡

```bash
# ç»Ÿè®¡é”™è¯¯æ•°é‡
pm2 logs tongxun-server --err --lines 1000 | grep -c "error"

# æŸ¥çœ‹æ‰€æœ‰é”™è¯¯
pm2 logs tongxun-server --err --lines 1000 | grep "error"
```

### 3. å¯¼å‡ºæ—¥å¿—

```bash
# å¯¼å‡ºæœ€è¿‘1000è¡Œæ—¥å¿—åˆ°æ–‡ä»¶
pm2 logs tongxun-server --lines 1000 > /tmp/tongxun-logs.txt

# å¯¼å‡ºé”™è¯¯æ—¥å¿—
pm2 logs tongxun-server --err --lines 1000 > /tmp/tongxun-errors.txt
```

---

## ğŸ“Œ å¸¸ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
pm2 logs tongxun-server --lines 50

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs tongxun-server --err --lines 50
```

### åœºæ™¯2ï¼šAPIè¯·æ±‚é—®é¢˜

```bash
# æŸ¥çœ‹æ‰€æœ‰è¯·æ±‚æ—¥å¿—
pm2 logs tongxun-server | grep "GET\|POST"

# æŸ¥çœ‹ç‰¹å®šAPIçš„æ—¥å¿—
pm2 logs tongxun-server | grep "/api/auth/login"
```

### åœºæ™¯3ï¼šæ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# æŸ¥çœ‹æ•°æ®åº“ç›¸å…³æ—¥å¿—
pm2 logs tongxun-server | grep "æ•°æ®åº“"

# æŸ¥çœ‹è¿æ¥é”™è¯¯
pm2 logs tongxun-server --err | grep "æ•°æ®åº“"
```

### åœºæ™¯4ï¼šWebSocketè¿æ¥é—®é¢˜

```bash
# æŸ¥çœ‹WebSocketæ—¥å¿—
pm2 logs tongxun-server | grep "WebSocket\|socket"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ—¥å¿—æ–‡ä»¶å¤§å°**ï¼šå®šæœŸæ¸…ç†æ—¥å¿—ï¼Œé¿å…å ç”¨è¿‡å¤šç£ç›˜ç©ºé—´
2. **æ—¥å¿—çº§åˆ«**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ `info` çº§åˆ«ï¼Œé¿å…è¿‡å¤šæ—¥å¿—
3. **æ—¥å¿—è½®è½¬**ï¼šå¯ä»¥é…ç½®æ—¥å¿—è½®è½¬ï¼Œè‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—
4. **æ•æ„Ÿä¿¡æ¯**ï¼šç¡®ä¿æ—¥å¿—ä¸­ä¸åŒ…å«å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯

---

## ğŸ› ï¸ æ—¥å¿—æ¸…ç†

```bash
# æ¸…ç©ºPM2æ—¥å¿—
pm2 flush

# åˆ é™¤æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
find /var/www/tongxun/server/logs/ -name "*.log" -mtime +7 -delete

# å‹ç¼©æ—§æ—¥å¿—
find /var/www/tongxun/server/logs/ -name "*.log" -mtime +7 -exec gzip {} \;
```


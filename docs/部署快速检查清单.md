# é˜¿é‡Œäº‘ECSéƒ¨ç½²å¿«é€Ÿæ£€æŸ¥æ¸…å•

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

### æœåŠ¡å™¨ä¿¡æ¯
- [ ] ECSå®ä¾‹å·²åˆ›å»º
- [ ] å…¬ç½‘IP: ________________
- [ ] æ“ä½œç³»ç»Ÿ: ________________
- [ ] SSHå¯è¿æ¥

### æœ¬åœ°å‡†å¤‡
- [ ] é¡¹ç›®ä»£ç å·²å¤‡ä»½
- [ ] æ•°æ®åº“å¤‡ä»½ï¼ˆå¦‚æœ‰ï¼‰
- [ ] æœåŠ¡å™¨IP/åŸŸåå·²è®°å½•

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰

### 1ï¸âƒ£ æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡
```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y  # Ubuntu
# æˆ–
yum update -y  # CentOS

# å®‰è£…Node.js (ä½¿ç”¨nvm)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
nvm alias default 18

# å®‰è£…MySQL
apt install mysql-server -y  # Ubuntu
# æˆ–
yum install mysql-server -y  # CentOS
systemctl start mysql
systemctl enable mysql
mysql_secure_installation

# å®‰è£…Redis
apt install redis-server -y  # Ubuntu
# æˆ–
yum install redis -y  # CentOS
systemctl start redis
systemctl enable redis

# å®‰è£…PM2
npm install -g pm2

# å®‰è£…Nginxï¼ˆå¯é€‰ï¼‰
apt install nginx -y  # Ubuntu
# æˆ–
yum install nginx -y  # CentOS
```

### 2ï¸âƒ£ ä¸Šä¼ é¡¹ç›®ä»£ç 
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /var/www/tongxun
cd /var/www/tongxun

# æ–¹å¼1: ä½¿ç”¨SCPï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
# scp -r server root@your-server-ip:/var/www/tongxun/

# æ–¹å¼2: ä½¿ç”¨Git
# git clone your-repo-url .

# æ–¹å¼3: ä½¿ç”¨FTPå·¥å…·ä¸Šä¼ 
```

### 3ï¸âƒ£ é…ç½®é¡¹ç›®
```bash
cd /var/www/tongxun/server

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®

# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE tongxun CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 4ï¸âƒ£ é…ç½®é˜²ç«å¢™
```bash
# Ubuntu (UFW)
ufw allow 22/tcp
ufw allow 3000/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable

# CentOS (firewalld)
firewall-cmd --permanent --add-port=22/tcp
firewall-cmd --permanent --add-port=3000/tcp
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --reload
```

### 5ï¸âƒ£ é…ç½®é˜¿é‡Œäº‘å®‰å…¨ç»„
- [ ] ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
- [ ] ECS â†’ å®‰å…¨ç»„ â†’ é…ç½®è§„åˆ™
- [ ] æ·»åŠ å…¥ç«™è§„åˆ™ï¼š
  - ç«¯å£22 (SSH): TCP, å…è®¸, æ¥æº: ä½ çš„IP
  - ç«¯å£3000 (API): TCP, å…è®¸, æ¥æº: 0.0.0.0/0
  - ç«¯å£80 (HTTP): TCP, å…è®¸, æ¥æº: 0.0.0.0/0
  - ç«¯å£443 (HTTPS): TCP, å…è®¸, æ¥æº: 0.0.0.0/0

### 6ï¸âƒ£ å¯åŠ¨æœåŠ¡
```bash
cd /var/www/tongxun/server

# ä½¿ç”¨PM2å¯åŠ¨
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# æ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤

# æŸ¥çœ‹çŠ¶æ€
pm2 list
pm2 logs tongxun-server
```

### 7ï¸âƒ£ æµ‹è¯•æœåŠ¡
```bash
# æµ‹è¯•API
curl http://localhost:3000/api/health
curl http://your-server-ip:3000/api/health

# æ£€æŸ¥ç«¯å£
netstat -tulpn | grep 3000
```

### 8ï¸âƒ£ é…ç½®Nginxï¼ˆå¯é€‰ä½†æ¨èï¼‰
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
nano /etc/nginx/sites-available/tongxun

# å†…å®¹è§éƒ¨ç½²æŒ‡å—

# å¯ç”¨é…ç½®
ln -s /etc/nginx/sites-available/tongxun /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

### 9ï¸âƒ£ ä¿®æ”¹Androidå®¢æˆ·ç«¯
- [ ] æ‰“å¼€ `app/src/main/java/com/tongxun/data/remote/NetworkModule.kt`
- [ ] ä¿®æ”¹ `BASE_URL` ä¸ºæœåŠ¡å™¨åœ°å€
- [ ] é‡æ–°ç¼–è¯‘APK

---

## ğŸ” éªŒè¯æ¸…å•

- [ ] Node.jsç‰ˆæœ¬: `node -v` (åº”è¯¥æ˜¯v18.x)
- [ ] MySQLè¿è¡Œ: `systemctl status mysql`
- [ ] Redisè¿è¡Œ: `redis-cli ping` (åº”è¿”å›PONG)
- [ ] PM2è¿›ç¨‹: `pm2 list` (tongxun-serveråº”ä¸ºonline)
- [ ] ç«¯å£ç›‘å¬: `netstat -tulpn | grep 3000`
- [ ] APIå¯è®¿é—®: `curl http://your-server-ip:3000/api/health`
- [ ] æ—¥å¿—æ­£å¸¸: `pm2 logs tongxun-server`
- [ ] å®¢æˆ·ç«¯å¯è¿æ¥: åœ¨æ‰‹æœºä¸Šæµ‹è¯•

---

## ğŸ“ é‡è¦æ–‡ä»¶è·¯å¾„

- é¡¹ç›®ç›®å½•: `/var/www/tongxun/server`
- ç¯å¢ƒå˜é‡: `/var/www/tongxun/server/.env`
- æ—¥å¿—ç›®å½•: `/var/www/tongxun/server/logs`
- PM2æ—¥å¿—: `/var/www/tongxun/server/logs/pm2-*.log`
- Nginxé…ç½®: `/etc/nginx/sites-available/tongxun`

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
pm2 logs tongxun-server
tail -f /var/www/tongxun/server/logs/combined.log
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
mysql -u root -p
systemctl status mysql
cat /var/www/tongxun/server/.env
```

### ç«¯å£è¢«å ç”¨
```bash
netstat -tulpn | grep 3000
lsof -i :3000
```

### å®¢æˆ·ç«¯æ— æ³•è¿æ¥
- æ£€æŸ¥BASE_URLæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ç«¯å£
- æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

```bash
# PM2ç®¡ç†
pm2 list                    # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 logs tongxun-server    # æŸ¥çœ‹æ—¥å¿—
pm2 restart tongxun-server # é‡å¯æœåŠ¡
pm2 stop tongxun-server    # åœæ­¢æœåŠ¡
pm2 delete tongxun-server  # åˆ é™¤æœåŠ¡
pm2 monit                  # ç›‘æ§é¢æ¿

# æœåŠ¡ç®¡ç†
systemctl status mysql     # MySQLçŠ¶æ€
systemctl status redis     # RedisçŠ¶æ€
systemctl status nginx     # NginxçŠ¶æ€

# æ—¥å¿—æŸ¥çœ‹
tail -f /var/www/tongxun/server/logs/combined.log
tail -f /var/log/nginx/tongxun-error.log
journalctl -u nginx
```


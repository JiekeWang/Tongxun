# ä¸Šä¼ æœåŠ¡å™¨ä»£ç å‘½ä»¤

## âš ï¸ é‡è¦æç¤º

**æœ¬æ¬¡ä¿®æ”¹ä¸éœ€è¦ä¸Šä¼ æœåŠ¡å™¨ä»£ç **ï¼Œå› ä¸ºï¼š
- âœ… åªä¿®æ”¹äº† Android å®¢æˆ·ç«¯ä»£ç ï¼ˆKotlinï¼‰
- âœ… æœåŠ¡å™¨ç«¯ API æ²¡æœ‰å˜åŒ–
- âœ… æœåŠ¡å™¨ç«¯ä»£ç ä¿æŒä¸å˜

---

## ğŸ“¤ å¦‚æœéœ€è¦ä¸Šä¼ æœåŠ¡å™¨ä»£ç ï¼ˆå°†æ¥ä¿®æ”¹æœåŠ¡å™¨æ—¶ï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ SCP ä¸Šä¼ æ•´ä¸ª server ç›®å½•ï¼ˆæ¨èï¼‰

```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰
cd E:\Tongxun

# ä¸Šä¼ æ•´ä¸ª server ç›®å½•
scp -r server root@47.116.197.230:/var/www/tongxun/
```

### æ–¹æ³•2ï¼šåªä¸Šä¼ ä¿®æ”¹çš„æ–‡ä»¶

```powershell
# ä¾‹å¦‚ï¼Œå¦‚æœåªä¿®æ”¹äº† friend.js
scp server/src/routes/friend.js root@47.116.197.230:/var/www/tongxun/server/src/routes/friend.js

# ä¾‹å¦‚ï¼Œå¦‚æœåªä¿®æ”¹äº† socketHandler.js
scp server/src/websocket/socketHandler.js root@47.116.197.230:/var/www/tongxun/server/src/websocket/socketHandler.js
```

### æ–¹æ³•3ï¼šä½¿ç”¨å‹ç¼©åŒ…ä¸Šä¼ ï¼ˆæ’é™¤ node_modulesï¼‰

```powershell
# 1. å‹ç¼© server ç›®å½•ï¼ˆæ’é™¤ node_modulesï¼‰
Compress-Archive -Path server -DestinationPath server.zip -Force

# 2. ä¸Šä¼ å‹ç¼©åŒ…
scp server.zip root@47.116.197.230:/tmp/

# 3. SSH ç™»å½•æœåŠ¡å™¨è§£å‹
ssh root@47.116.197.230
cd /var/www/tongxun/server
unzip -o /tmp/server.zip
rm /tmp/server.zip

# 4. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm install --production

# 5. é‡å¯æœåŠ¡
pm2 restart tongxun-server
```

---

## ğŸ”„ ä¸Šä¼ åå¿…é¡»æ‰§è¡Œçš„æ“ä½œ

### 1. SSH ç™»å½•æœåŠ¡å™¨

```bash
ssh root@47.116.197.230
```

### 2. è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /var/www/tongxun/server
```

### 3. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœä¸Šä¼ äº†æ–°æ–‡ä»¶ï¼‰

```bash
npm install --production
```

### 4. é‡å¯æœåŠ¡

```bash
# ä½¿ç”¨ PM2 é‡å¯
pm2 restart tongxun-server

# æˆ–é‡æ–°åŠ è½½ï¼ˆ0ç§’åœæœºï¼‰
pm2 reload tongxun-server
```

### 5. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs tongxun-server

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
pm2 logs tongxun-server --lines 50

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list
```

---

## âœ… éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:3000/api/health

# åº”è¯¥è¿”å›ï¼š{"status":"ok","timestamp":"..."}
```

---

## ğŸ“‹ å¿«é€Ÿä¸Šä¼ è„šæœ¬ï¼ˆWindows PowerShellï¼‰

åˆ›å»ºæ–‡ä»¶ï¼š`upload-server.ps1`

```powershell
# ä¸Šä¼ æœåŠ¡å™¨ä»£ç è„šæœ¬
$serverIP = "47.116.197.230"
$serverUser = "root"
$localPath = "server"
$remotePath = "/var/www/tongxun"

Write-Host "å¼€å§‹ä¸Šä¼ æœåŠ¡å™¨ä»£ç ..." -ForegroundColor Green

# å‹ç¼© server ç›®å½•ï¼ˆæ’é™¤ node_modules å’Œ logsï¼‰
$tempDir = "server_temp"
New-Item -ItemType Directory -Force -Path $tempDir | Out-Null
Copy-Item -Path "$localPath\*" -Destination $tempDir -Recurse -Exclude node_modules,logs,.env
Compress-Archive -Path $tempDir -DestinationPath server.zip -Force
Remove-Item -Recurse -Force $tempDir

Write-Host "ä¸Šä¼ å‹ç¼©åŒ…åˆ°æœåŠ¡å™¨..." -ForegroundColor Yellow
scp server.zip "${serverUser}@${serverIP}:/tmp/"

if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… ä¸Šä¼ æˆåŠŸï¼" -ForegroundColor Green
    Write-Host "ç°åœ¨è¯·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š" -ForegroundColor Yellow
    Write-Host "ssh ${serverUser}@${serverIP}" -ForegroundColor Cyan
    Write-Host "cd /var/www/tongxun/server && unzip -o /tmp/server.zip && npm install --production && pm2 restart tongxun-server" -ForegroundColor Cyan
} else {
    Write-Host "âŒ ä¸Šä¼ å¤±è´¥ï¼" -ForegroundColor Red
}

Remove-Item -Force server.zip -ErrorAction SilentlyContinue
```

ä½¿ç”¨æ–¹æ³•ï¼š
```powershell
.\upload-server.ps1
```

---

## ğŸ¯ å¸¸ç”¨ä¸Šä¼ åœºæ™¯

### åœºæ™¯1ï¼šåªä¿®æ”¹äº†å•ä¸ªè·¯ç”±æ–‡ä»¶

```powershell
# ä¸Šä¼ å•ä¸ªæ–‡ä»¶
scp server/src/routes/friend.js root@47.116.197.230:/var/www/tongxun/server/src/routes/friend.js

# ç„¶å SSH é‡å¯æœåŠ¡
ssh root@47.116.197.230 "cd /var/www/tongxun/server && pm2 restart tongxun-server"
```

### åœºæ™¯2ï¼šä¿®æ”¹äº†å¤šä¸ªæ–‡ä»¶

```powershell
# ä¸Šä¼ æ•´ä¸ª src ç›®å½•
scp -r server/src root@47.116.197.230:/var/www/tongxun/server/

# é‡å¯æœåŠ¡
ssh root@47.116.197.230 "cd /var/www/tongxun/server && pm2 restart tongxun-server"
```

### åœºæ™¯3ï¼šæ›´æ–°é…ç½®æ–‡ä»¶

```powershell
# ä¸Šä¼ é…ç½®æ–‡ä»¶ï¼ˆæ³¨æ„ï¼š.env æ–‡ä»¶ä¸åº”è¯¥ä¸Šä¼ ï¼‰
scp server/ecosystem.config.js root@47.116.197.230:/var/www/tongxun/server/
scp server/package.json root@47.116.197.230:/var/www/tongxun/server/

# å¦‚æœéœ€è¦å®‰è£…æ–°ä¾èµ–
ssh root@47.116.197.230 "cd /var/www/tongxun/server && npm install --production && pm2 restart tongxun-server"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦ä¸Šä¼  `.env` æ–‡ä»¶**ï¼šç¯å¢ƒå˜é‡æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåº”è¯¥åœ¨æœåŠ¡å™¨ä¸Šå•ç‹¬é…ç½®
2. **æ’é™¤ `node_modules`**ï¼šåœ¨æœåŠ¡å™¨ä¸Šé‡æ–°å®‰è£…ä¾èµ–æ›´å¿«æ›´å¯é 
3. **å¤‡ä»½é‡è¦æ–‡ä»¶**ï¼šä¸Šä¼ å‰å¯ä»¥å¤‡ä»½æœåŠ¡å™¨ä¸Šçš„åŸæ–‡ä»¶
4. **ä¸Šä¼ åå¿…é¡»é‡å¯**ï¼šä¿®æ”¹ä»£ç åå¿…é¡»é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ
5. **æ£€æŸ¥æ—¥å¿—**ï¼šä¸Šä¼ åæŸ¥çœ‹æ—¥å¿—ç¡®è®¤æœåŠ¡æ­£å¸¸å¯åŠ¨

---

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœä¸Šä¼ å¤±è´¥

1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   ping 47.116.197.230
   ```

2. **æ£€æŸ¥ SSH è¿æ¥**
   ```bash
   ssh root@47.116.197.230
   ```

3. **æ£€æŸ¥ç£ç›˜ç©ºé—´**
   ```bash
   ssh root@47.116.197.230 "df -h"
   ```

### å¦‚æœæœåŠ¡æ— æ³•å¯åŠ¨

1. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**
   ```bash
   pm2 logs tongxun-server --err --lines 50
   ```

2. **æ£€æŸ¥æ–‡ä»¶æƒé™**
   ```bash
   ls -la /var/www/tongxun/server/src/
   ```

3. **æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæ•´**
   ```bash
   cd /var/www/tongxun/server
   npm install
   ```


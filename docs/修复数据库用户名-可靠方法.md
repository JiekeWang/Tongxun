# 修复数据库用户名 - 可靠方法

## 问题
sed 命令没有生效，可能是行尾符或格式问题。

## 方法1：直接替换（不依赖行尾符）

```bash
cd /var/www/tongxun/server
sed -i 's/DB_USER=root/DB_USER=wangjia/' .env
```

## 方法2：使用 sed 替换整行（更可靠）

```bash
cd /var/www/tongxun/server
sed -i '/^DB_USER=/s/root/wangjia/' .env
```

## 方法3：使用 awk（最可靠）

```bash
cd /var/www/tongxun/server
awk '/^DB_USER=/ {sub(/root/, "wangjia")} 1' .env > .env.tmp && mv .env.tmp .env
```

## 方法4：手动编辑（最安全）

```bash
cd /var/www/tongxun/server
nano .env
```

找到这一行：
```
DB_USER=root
```

改为：
```
DB_USER=wangjia
```

按 `Ctrl+X`，输入 `Y` 确认，回车保存。

## 方法5：使用 perl（处理各种行尾符）

```bash
cd /var/www/tongxun/server
perl -pi -e 's/^DB_USER=root$/DB_USER=wangjia/' .env
```

## 方法6：先查看文件内容，确认格式

```bash
cd /var/www/tongxun/server
cat -A .env | grep DB_USER
```

这会显示行尾符和特殊字符：
- `$` 表示 Unix 行尾（\n）
- `^M$` 表示 Windows 行尾（\r\n）

## 推荐操作步骤

### 步骤1：查看当前内容
```bash
cd /var/www/tongxun/server
cat -A .env | grep DB_USER
```

### 步骤2：尝试方法1（最简单）
```bash
sed -i 's/DB_USER=root/DB_USER=wangjia/' .env
```

### 步骤3：验证
```bash
grep DB_USER .env
```

### 步骤4：如果还是不行，使用方法4（手动编辑）
```bash
nano .env
```

## 如果文件有 Windows 行尾符

先转换行尾符：
```bash
# 安装 dos2unix（如果没有）
yum install dos2unix -y

# 转换行尾符
dos2unix /var/www/tongxun/server/.env

# 然后再执行 sed
sed -i 's/^DB_USER=root$/DB_USER=wangjia/' .env
```

## 完整操作（推荐）

```bash
cd /var/www/tongxun/server

# 1. 查看当前内容
echo "=== 修改前 ==="
grep DB_USER .env

# 2. 备份
cp .env .env.backup

# 3. 修改（尝试多种方法）
sed -i 's/DB_USER=root/DB_USER=wangjia/' .env

# 4. 验证
echo "=== 修改后 ==="
grep DB_USER .env

# 5. 如果还是 root，手动编辑
if grep -q "DB_USER=root" .env; then
    echo "需要手动编辑，执行: nano .env"
    nano .env
fi

# 6. 最终验证
grep DB_USER .env
```

